---
title: "Project 4 - Error Detection"
author: "Hongru Liu hl3148"
output:
  pdf_document: default
  html_document:
    df_print: paged
  html_notebook: default
---

## Step 0: environment setting

### Load required packages

```{r}
if(!require("tm")){
  install.packages("tm")
}
if(!require("qdap")){
  install.packages("qdap")
}
library(tm) # VCorpus
library(qdap) # clean
# library(purrr)
# library(ngram)
# library(NLP)
# library(reshape2)
```

### Specify directories

Please change the working directory to the folder containing this Rmd file.

```{r}
setwd("/Users/hongru/Documents/GitHub/Fall2018-Project4-sec1proj4_grp6/Github/doc")
## setwd("../Fall2018-Project4-sec1proj4_grp6/Github/doc")
## use relative path for reproducibility
```

## Step 1: construct a positional binary matrix using ground truth texts

*Note that for the final result, we construct a positional binary list of letter bigrams instead of a matrix. But the former one could be used in the same way as the latter one.*

Call all the required customized functions from the library. 

```{r}
source("../lib/get_text.R")
source("../lib/bigramize.R")
```

Read the ground truth text from files.

```{r}
ground_truth_dir <-"../data/ground_truth"
ground_truth_file_name <- list.files(ground_truth_dir)
ground_truth_file_path <- paste0(ground_truth_dir,'/',ground_truth_file_name)
ground_truth_onelines <- lapply(ground_truth_file_path,get_text)
```

Clean the ground truth texts, convert them to words and sort the words by letter length.

*Clean the text by removing all numbers, punctuations, special symbols. Only letters are retained*

```{r}
ground_truth_words_cleaned <- unlist(lapply(ground_truth_onelines,clean_text))
ground_truth_by_length <- sort_by_length(ground_truth_words_cleaned)
```

Construct letter bigrams for the ground truth words

```{r}
### Construct letter bigrams for the words having length >= 3
num_len <- length(ground_truth_by_length)
ground_truth_bigram_from3 <- lapply(ground_truth_by_length[3:num_len],bigramize)
# save(ground_truth_bigram_from3,file="../output/ground_truth_bigram_from3.Rdata")
# load("../output/ground_truth_bigram_from3.Rdata")

### include words having length <= 2
ground_truth_bigram <- c(list(l_1=list(PD_1=ground_truth_by_length[[1]]),
                              l_2=list(PD_1_2=ground_truth_by_length[[2]])),
                         ground_truth_bigram_from3)
# save(ground_truth_bigram,file="../output/ground_truth_bigram.Rdata")
# load("../output/ground_truth_bigram.Rdata")

### romove duplicate bigrams
ground_truth_unibig <- lapply(ground_truth_bigram,unique_bigram) ### this is the final bigram list for error detection
save(ground_truth_unibig,file="../output/ground_truth_unibig.Rdata") 
# load("../output/ground_truth_unibig.Rdata")
```

## Step 2: construct a word list using tesseract texts

Read the tesseract text from files.

```{r}
tesseract_dir <- "../data/tesseract"
tesseract_file_name <- list.files(tesseract_dir)
tesseract_file_path <- paste0(tesseract_dir,'/',tesseract_file_name)
tesseract_onelines <- lapply(tesseract_file_path,get_text)
```

Clean the tesseract texts, convert them to words.

```{r}
tesseract_words_cleaned <- lapply(tesseract_onelines,clean_text)
save(tesseract_words_cleaned,file="../output/tesseract_words_cleaned.Rdata")
# load("../output/tesseract_words_cleaned.Rdata")
```

## Step 3: error detection

Call all the required customized functions from the library. 

```{r}
source("../lib/make_label.R")
```

Construct a label list that indicates whether a word in the given string is an error. `label = 1` means the corresponding word is an error and `label = 0` means the word is not an error

```{r}
tesseract_labels <- make_label(tesseract_words_cleaned,ground_truth_unibig)
### optional - change names of label lists
names(tesseract_labels) <- ground_truth_file_name
for (i in 1:length(tesseract_labels)) {
  names(tesseract_labels[[i]]) <- unlist(strsplit(tesseract_words_cleaned[[i]]," "))
}
save(tesseract_labels,file="../output/tesseract_labels.Rdata")
# load("../output/tesseract_labels.Rdata")
```

Preliminary result analysis

```{r}
error_rate <- (sapply(tesseract_labels, sum)/sapply(tesseract_words_cleaned, length))
summary(error_rate)
```


